{% extends "base.html" %}

{% block title %}Bank Routing - AlgoBank{% endblock %}

{% block content %}
<div class="page-container">
    <div class="section-box">
        <div class="section-box-header">
            <div>
                <h3>Interbank Routing System</h3>
                <p class="page-subtitle" style="margin-top: 0.5rem; margin-bottom: 0;">Find the cheapest route between banks</p>
            </div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <div class="card">
            <div class="card-header">
                <h3>Calculate Route</h3>
            </div>
            <div class="card-body">
                <form id="routingForm" onsubmit="calculateRoute(event)">
                    <div class="form-group">
                        <label for="startBank">From Bank</label>
                        <select id="startBank" name="start" required>
                            <option value="">Select bank</option>
                            <option value="BankA">Bank A</option>
                            <option value="BankB">Bank B</option>
                            <option value="BankC">Bank C</option>
                            <option value="BankD">Bank D</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="endBank">To Bank</label>
                        <select id="endBank" name="end" required>
                            <option value="">Select bank</option>
                            <option value="BankA">Bank A</option>
                            <option value="BankB">Bank B</option>
                            <option value="BankC">Bank C</option>
                            <option value="BankD">Bank D</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Find Route</button>
                </form>
                <div id="routingResult" class="result-section"></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>Network Map</h3>
            </div>
            <div class="card-body">
                <div class="network-diagram">
                    <div class="bank-node">Bank A</div>
                    <div class="bank-node">Bank B</div>
                    <div class="bank-node">Bank C</div>
                    <div class="bank-node">Bank D</div>
                    <p class="info-text">A ↔ B: 3 | B ↔ C: 2 | A ↔ C: 10 | C ↔ D: 1</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function calculateRoute(e) {
        e.preventDefault();
        const start = document.getElementById('startBank').value;
        const end = document.getElementById('endBank').value;
        const resultDiv = document.getElementById('routingResult');
        
        if (start === end) {
            resultDiv.innerHTML = '<p class="error">Please select different banks</p>';
            return;
        }
        
        resultDiv.innerHTML = '<p class="loading">Calculating route...</p>';
        
        fetch('/api/routing', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({start: start, end: end})
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                resultDiv.innerHTML = `
                    <div class="result-box success">
                        <h4>Optimal Route</h4>
                        <div class="route-path">${data.path.join(' → ')}</div>
                        <div class="result-value">Cost: ${data.cost}</div>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="result-box error">
                        <h4>Route Not Found</h4>
                        <p>No path exists between these banks</p>
                    </div>
                `;
            }
        })
        .catch(err => {
            resultDiv.innerHTML = '<p class="error">Error calculating route</p>';
        });
    }
</script>
{% endblock %}

